/*******************************************************************************
 *  * Watson Health Imaging Analytics
 *  *
 *  * IBM Confidential
 *  *
 *  * OCO Source Materials
 *  *
 *  * (C) Copyright IBM Corp. 2020
 *  *
 *  * The source code for this program is not published or otherwise
 *  * divested of its trade secrets, irrespective of what has been
 *  * deposited with the U.S. Copyright Office.
 *******************************************************************************/
package org.ibm.wh.engmnt.orp.service.impl.test;

import static org.junit.Assert.assertNotNull;

import java.text.ParseException;

import org.ibm.wh.engmnt.orp.service.impl.CarePlanServiceImpl;
import org.ibm.wh.engmnt.orp.service.impl.CommunicationRequestServiceImpl;
import org.junit.Test;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.ibm.fhir.model.generator.exception.FHIRGeneratorException;

public class MeasureReportServiceImplTest {

	String carePlanIdentifier = "exampleCareplanIdentifier";
	String communicationRequestId = "examplecommunicationRequestId";
	String patientId = "examplePatientId";
	String practitionerId = "examplePracttioner";
	String practitionerRoleId = "examplePractitionerRole";
	String practitionerInfo = "{\"resourceType\":\"Practitioner\",\"meta\":{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/tenant-id\",\"valuePositiveInt\":1}],\"source\":\"http://acme-health.com/epic\",\"profile\":[\"http://ibm.com/fhir/cdm/StructureDefinition/cdm-practitioner\"]},\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/practitioner-seealso\",\"valueReference\":{\"reference\":\"Practitioner/9f13ae8e-460c-4a62-89c8-19f949fd6xyz\"}}],\"identifier\":[{\"use\":\"official\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"NPI\",\"display\":\"National provider identifier\"}]},\"system\":\"http://hl7.org/fhir/sid/us-npi\",\"value\":\"1122334499\",\"assigner\":{\"display\":\"cms.gov\"}},{\"use\":\"official\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"PRN\",\"display\":\"Provider number\"}]},\"system\":\"http://acme-health.com/epic/practitioner\",\"value\":\"0d82c96d-98c5-46cf-911d-a41991601320\",\"assigner\":{\"display\":\"Acme Health - Epic\"}},{\"use\":\"secondary\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"TAX\",\"display\":\"Tax ID Number\"}]},\"system\":\"http://hl7.org/fhir/sid/us-tin\",\"value\":\"123456789\",\"assigner\":{\"display\":\"irs.gov\"}}],\"name\":[{\"text\":\"Dr Debra R Kelly, MD\",\"family\":\"Kelly\",\"given\":[\"Debra\",\"R\"],\"prefix\":[\"Dr\"],\"suffix\":[\"MD\"]}],\"telecom\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/contactpoint-country\",\"valueString\":\"1\"},{\"url\":\"http://hl7.org/fhir/StructureDefinition/contactpoint-extension\",\"valueString\":\"4321\"}],\"system\":\"phone\",\"value\":\"808-248-8689\",\"use\":\"work\",\"rank\":1},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/contactpoint-country\",\"valueString\":\"1\"}],\"system\":\"fax\",\"value\":\"808-248-8689\",\"use\":\"work\",\"rank\":2},{\"system\":\"email\",\"value\":\"drdobbs@fakedemail.com\",\"use\":\"work\",\"rank\":3}],\"address\":[{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/county-code\",\"valueString\":\"48009\"},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/region-code\",\"valueString\":\"01\"},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/prov-region\",\"valueString\":\"AB\"}],\"use\":\"work\",\"type\":\"physical\",\"line\":[\"98-1079 Moanolua\",\"Suite 200\"],\"city\":\"Aiea\",\"district\":\"Honolulu\",\"state\":\"HI\",\"postalCode\":\"96701\",\"country\":\"US\"}],\"gender\":\"male\"}";
	String contractConfigInfo = "{\"contract.Identifier\":\"Id value\",\"contract.Name\":\" Name\",\"contract.TenantId\":\"TenantId value\",\"modality\":{\"preference\":{\"text\":{\"enabled\":true,\"rank\":1},\"email\":{\"enabled\":true,\"rank\":2},\"voice\":{\"enabled\":true,\"rank\":3}}},\"measure\":[{\"identifier\":\"fhir measure identifier value\",\"priority\":1,\"category\":{\"identifier\":\"1\",\"priority\":1}},{\"identifier\":\"fhir measure identifier value\",\"priority\":2,\"category\":{\"identifier\":\"1\",\"priority\":2}}],\"offerings\":{\"outreach\":{\"isenabled\":true,\"communication\":{\"timeZone\":\"CST\",\"holidaySchedule\":{\"static\":[{\"name\":\"New Year Day\",\"date\":1,\"month\":1},{\"name\":\"Christmas Day\",\"date\":25,\"month\":12}],\"dynamic\":[{\"name\":\"Memorial Day\",\"dayofweek\":\"Monday\",\"islastweekofmonth\":true,\"weekofmonth\":null,\"month\":5},{\"name\":\"Independence Day\",\"dayofweek\":\"Friday\",\"islastweekofmonth\":false,\"weekofmonth\":1,\"month\":7},{\"name\":\"Labor Day\",\"dayofweek\":\"Monday\",\"islastweekofmonth\":false,\"weekofmonth\":1,\"month\":9},{\"name\":\"Thanksgiving Day\",\"dayofweek\":\"Thursday\",\"islastweekofmonth\":false,\"weekofmonth\":4,\"month\":11}]}},\"modality\":{\"text\":{\"enabled\":true,\"rank\":1,\"template\":\"<xsl:stylesheet xmlns:xsl=\\\"http://www.w3.org/1999/XSL/Transform\\\" version=\\\"1.0\\\">\\r\\n  <xsl:output omit-xml-declaration=\\\"yes\\\" indent=\\\"yes\\\" />\\r\\n  <xsl:template match=\\\"/\\\">\\r\\n    <xsl:call-template name=\\\"TEXT\\\" />\\r\\n  <\\/xsl:template>\\r\\n  <xsl:template name=\\\"TEXT\\\">\\r\\n    <xsl:value-of select=\\\"//Text/Message/Body\\\" /> Txt STOP to opt-out. Msg-Data rates may apply.\\r\\n   <\\/xsl:template>\\r\\n<\\/xsl:stylesheet>\",\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"},\"retrySettings\":{\"waitPeriodInDaysNextAttempt\":\"1\",\"numberOfRetrailsPerDay\":\"10\",\"timeIntervalInMin\":\"10\"},\"waitPeriodInDaysNextCommunication\":\"30\",\"volumePerDay\":\"10000\",\"sender\":\"18773558433\",\"shortCode\":\"\",\"carrier\":\"99901\",\"vendors\":[{\"name\":\"Genesis\",\"url\":\"\",\"userid\":\"\",\"password\":\"\"}]},\"email\":{\"enabled\":true,\"rank\":2,\"template\":\"<xsl:stylesheet xmlns:xsl=\\\"http://www.w3.org/1999/XSL/Transform\\\" version=\\\"1.0\\\">\\r\\n  <xsl:output omit-xml-declaration=\\\"yes\\\" indent=\\\"yes\\\" />\\r\\n  <xsl:template match=\\\"/\\\">\\r\\n    <xsl:call-template name=\\\"TEXT\\\" />\\r\\n  <\\/xsl:template>\\r\\n  <xsl:template name=\\\"TEXT\\\">\\r\\n    <xsl:value-of select=\\\"//Text/Message/Body\\\" /> Txt STOP to opt-out. Msg-Data rates may apply.\\r\\n   <\\/xsl:template>\\r\\n<\\/xsl:stylesheet>\",\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"},\"retrySettings\":{\"waitPeriodInDaysNextAttempt\":\"1\",\"numberOfRetrysPerDay\":\"10\",\"timeIntervalInMin\":\"10\"},\"waitPeriodInDaysNextCommunication\":\"30\",\"volumePerDay\":\"10000\",\"sender\":\"test@test.com\",\"displayName\":\"\",\"vendors\":[{\"name\":\"Jango\",\"url\":\"\",\"userid\":\"\",\"password\":\"\"}]}},\"locations\":[\"TIN1\",\"TIN2\"],\"practitioners\":[\"NPI1\",\"NPI2\"]}}}";
	String patientInfo = "{\"resourceType\":\"Patient\",\"id\":\"17a7a4b2-d192-491c-b69b-b0c1d3e60ccd\",\"meta\":{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/tenant-id\",\"valuePositiveInt\":1}],\"versionId\":\"1\",\"lastUpdated\":\"2020-07-04T06:54:33.32Z\",\"source\":\"http://acme-health.com/epic\",\"profile\":[\"http://ibm.com/fhir/cdm/StructureDefinition/cdm-patient\"]},\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/primary-payor\",\"valueReference\":{\"reference\":\"Organization/123\"}},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/secondary-payor\",\"valueReference\":{\"reference\":\"Organization/456\"}},{\"url\":\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex\",\"valueCode\":\"M\"},{\"extension\":[{\"url\":\"ombCategory\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2106-3\",\"display\":\"White\"}},{\"url\":\"detailed\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2116-2\",\"display\":\"Scottish\"}},{\"url\":\"detailed\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2112-1\",\"display\":\"German\"}},{\"url\":\"text\",\"valueString\":\"White\"}],\"url\":\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\"},{\"extension\":[{\"url\":\"ombCategory\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2135-2\",\"display\":\"Hispanic or Latino\"}},{\"url\":\"detailed\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2157-6\",\"display\":\"Guatemalan\"}},{\"url\":\"text\",\"valueString\":\"Hispanic or Latino\"}],\"url\":\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity\"},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/status-code\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://ibm.com/fhir/cdm/CodeSystem/patient-status-code-system\",\"code\":\"deactivated\",\"display\":\"Deactivated\"}]}},{\"url\":\"http://hl7.org/fhir/StructureDefinition/patient-importance\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v3-PatientImportance\",\"code\":\"VIP\",\"display\":\"Very Important Person\"}]}},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/family-id\",\"valueString\":\"DummyFamilyId\"}],\"identifier\":[{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/encrypted-state\",\"valueBoolean\":false}],\"use\":\"official\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"RI\",\"display\":\"Resource Identifier\"}]},\"system\":\"http://acme-health.com/epic/patient\",\"value\":\"9f13ae8e-460c-4a62-89c8-19f949fd6bcd\",\"assigner\":{\"display\":\"Acme Health - Epic\"}}],\"active\":true,\"name\":[{\"text\":\"John Q. Doe\",\"family\":\"Doe\",\"given\":[\"John\",\"Q\"]}],\"telecom\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/contactpoint-country\",\"valueString\":\"1\"}],\"system\":\"sms\",\"value\":\"808-248-8699\",\"use\":\"mobile\",\"rank\":1},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/contactpoint-country\",\"valueString\":\"1\"},{\"url\":\"http://hl7.org/fhir/StructureDefinition/contactpoint-extension\",\"valueString\":\"4321\"}],\"system\":\"phone\",\"value\":\"808-248-8689\",\"use\":\"work\",\"rank\":2}],\"gender\":\"male\",\"birthDate\":\"1983-04-23\",\"address\":[{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/county-code\",\"valueString\":\"48009\"},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/region-code\",\"valueString\":\"01\"}],\"use\":\"home\",\"type\":\"physical\",\"line\":[\"98-1079 Moanolua\",\"Suite 200\"],\"city\":\"Aiea\",\"district\":\"Honolulu\",\"state\":\"HI\",\"postalCode\":\"96701\",\"country\":\"US\"}],\"communication\":[{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/language-rank\",\"valuePositiveInt\":1}],\"language\":{\"coding\":[{\"system\":\"urn:ietf:bcp:47\",\"code\":\"en\",\"display\":\"English\"}]}}],\"generalPractitioner\":[{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/reference-code\",\"valueCoding\":{\"system\":\"http://ibm.com/fhir/cdm/CodeSystem/attribution-code-system\",\"code\":\"client-emr-pcp\",\"display\":\"Client EMR PCP\"}},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/reference-period\",\"valuePeriod\":{\"start\":\"2018-01-01\",\"end\":\"2020-12-31\"}}],\"reference\":\"PractitionerRole/8d04a556-0bbf-41ae-a41f-c70865427752\"},{\"extension\":[{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/reference-code\",\"valueCoding\":{\"system\":\"http://ibm.com/fhir/cdm/CodeSystem/attribution-code-system\",\"code\":\"eng-attr-pcp\",\"display\":\"Engagement Attributed PCP\"}},{\"url\":\"http://ibm.com/fhir/cdm/StructureDefinition/reference-period\",\"valuePeriod\":{\"start\":\"2019-01-01\",\"end\":\"2019-12-31\"}}],\"reference\":\"PractitionerRole/8d04a556-0bbf-41ae-a41f-c70865427752\"}]}";
	String careGapName = "exampleCareGap";
	String facilityAddress = "exampleFacilityAddress";
	String locationData="{\"locations\":[{\"id\":\"TIN1\",\"enabled\":true,\"modality\":{\"preference\":{\"text\":{\"enabled\":true,\"rank\":1,\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"}},\"email\":{\"enabled\":true,\"rank\":2,\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"}},\"voice\":{\"enabled\":true,\"rank\":3,\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"}}}},\"communication\":{\"timeZone\":\"CST\",\"holidaySchedule\":{\"static\":[{\"name\":\"New Year Day\",\"date\":1,\"month\":1},{\"name\":\"Christmas Day\",\"date\":25,\"month\":12}],\"dynamic\":[{\"name\":\"Memorial Day\",\"dayofweek\":\"Monday\",\"islastweekofmonth\":true,\"weekofmonth\":null,\"month\":5},{\"name\":\"Independence Day\",\"dayofweek\":\"Friday\",\"islastweekofmonth\":false,\"weekofmonth\":1,\"month\":7},{\"name\":\"Labor Day\",\"dayofweek\":\"Monday\",\"islastweekofmonth\":false,\"weekofmonth\":1,\"month\":9},{\"name\":\"Thanksgiving Day\",\"dayofweek\":\"Thursday\",\"islastweekofmonth\":false,\"weekofmonth\":4,\"month\":11}]}}},{\"id\":\"TIN2\",\"enabled\":true,\"modality\":{\"preference\":{\"text\":{\"enabled\":true,\"rank\":1,\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"}},\"email\":{\"enabled\":true,\"rank\":2,\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"}},\"voice\":{\"enabled\":true,\"rank\":3,\"window\":{\"startTime\":\"08:00:00\",\"endTime\":\"10:00:00\"}}}},\"communication\":{\"timeZone\":\"CST\",\"holidaySchedule\":{\"static\":[{\"name\":\"New Year Day\",\"date\":1,\"month\":1},{\"name\":\"Christmas Day\",\"date\":25,\"month\":12}],\"dynamic\":[{\"name\":\"Memorial Day\",\"dayofweek\":\"Monday\",\"islastweekofmonth\":true,\"weekofmonth\":null,\"month\":5},{\"name\":\"Independence Day\",\"dayofweek\":\"Friday\",\"islastweekofmonth\":false,\"weekofmonth\":1,\"month\":7},{\"name\":\"Labor Day\",\"dayofweek\":\"Monday\",\"islastweekofmonth\":false,\"weekofmonth\":1,\"month\":9},{\"name\":\"Thanksgiving Day\",\"dayofweek\":\"Thursday\",\"islastweekofmonth\":false,\"weekofmonth\":4,\"month\":11}]}}}]}";

	@Test
	public void generateFhirCarePlanModelTestSuccess() throws FHIRGeneratorException, JsonProcessingException {
		CarePlanServiceImpl careplanServiceImpl = new CarePlanServiceImpl();
		String carePlanModelData = careplanServiceImpl.generateFhirCarePlanModel(carePlanIdentifier,
				communicationRequestId, practitionerRoleId, patientId, careGapName);
		assertNotNull(carePlanModelData);
	}

	@Test
	public void generateFhirCommunicationRequestModelTest()
			throws FHIRGeneratorException, JsonProcessingException, ParseException {
		CommunicationRequestServiceImpl communicationRequestServiceImpl = new CommunicationRequestServiceImpl();
		String fhirData = communicationRequestServiceImpl.generateFhirCommunicationRequestModel(contractConfigInfo,"117",
				practitionerId, practitionerRoleId, patientInfo, practitionerInfo, careGapName, facilityAddress,locationData);
		assertNotNull(fhirData);
	}
}
